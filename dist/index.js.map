{"version":3,"sources":["../index.js"],"names":["actionHandler","actionCreator","connect","create","actions","actionHandlers","commonSelectors","defaultSelector","x","types","init","dispatch","uniqueId","Date","getTime","createStateMapper","prop","substr","state","props","defaultMiddleware","store","action","handler","toString","next","type","name","actionMetadata","creator","payload","extraProps","Object","assign","actionCreators","entries","forEach","pair","mapStateToProps","args","split","structuredSelector","originalConnect","initialState","currentReducer","lazyDispatch","defaultReducer","actionResult","setTimeout","middlewares","applyMiddleware","concat","reducer","prevReducer","Provider","React","createElement"],"mappings":"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","file":"index.js","sourcesContent":["import { createStore, applyMiddleware, combineReducers } from \"redux\";\r\nimport React from \"react\";\r\nimport { connect as originalConnect, Provider } from \"react-redux\";\r\nimport { createSelector, createStructuredSelector } from \"reselect\";\r\n\r\nconst actions = {};\r\nconst actionHandlers = {};\r\nconst commonSelectors = {};\r\nconst defaultSelector = x => x;\r\nconst types = {\r\n  init: \"@@init\",\r\n  dispatch: \"@@dispatch\"\r\n};\r\nlet uniqueId = new Date().getTime();\r\n\r\nfunction createStateMapper(prop) {\r\n  if (prop[0] === \"@\") {\r\n    prop = prop.substr(1);\r\n    return (state, props) => props[prop];\r\n  }\r\n  return state => state[prop];\r\n}\r\n\r\nfunction defaultMiddleware(store) {\r\n  return next => action => {\r\n    if (action.handler && action.handler.toString() in actionHandlers) {\r\n      return actionHandlers[action.handler](store, next, action);\r\n    }\r\n    return next(action);\r\n  };\r\n}\r\n\r\n/**\r\n * register dynamic action handler\r\n * @param handler\r\n */\r\nexport function actionHandler(handler) {\r\n  if (!handler.type) {\r\n    handler.type = `@@${handler.name}_${uniqueId++}`;\r\n  }\r\n\r\n  actionHandlers[handler.type] = handler;\r\n\r\n  return handler.type;\r\n}\r\n\r\nexport function actionCreator(action) {\r\n  // single action creator\r\n  if (typeof action === \"function\") {\r\n    if (!action.type) {\r\n      action.type = `@@${action.name}_${uniqueId++}`;\r\n    }\r\n    let actionMetadata = actions[action.type];\r\n    if (!actionMetadata) {\r\n      actions[action.type] = actionMetadata = {\r\n        handler: action,\r\n        creator(payload, extraProps) {\r\n          return Object.assign({ type: action.type, payload }, extraProps);\r\n        }\r\n      };\r\n    }\r\n\r\n    return actionMetadata.creator;\r\n  }\r\n  // support multiple action creators\r\n  const actionCreators = {};\r\n  Object.entries(action).forEach(\r\n    pair => (actionCreators[pair[0]] = actionCreator(pair[1]))\r\n  );\r\n  return actionCreators;\r\n}\r\n\r\nexport function connect(mapStateToProps, ...args) {\r\n  if (mapStateToProps) {\r\n    // support named props\r\n    if (typeof mapStateToProps === \"string\") {\r\n      const props = mapStateToProps.split(/\\s+/);\r\n      const structuredSelector = {};\r\n      props.forEach(\r\n        prop =>\r\n          (structuredSelector[prop[0] === \"@\" ? prop.substr(1) : prop] =\r\n            commonSelectors[prop] ||\r\n            (commonSelectors[prop] = createSelector(\r\n              createStateMapper(prop),\r\n              defaultSelector\r\n            )))\r\n      );\r\n      mapStateToProps = structuredSelector;\r\n    }\r\n    if (typeof mapStateToProps !== \"function\") {\r\n      return originalConnect(\r\n        createStructuredSelector(mapStateToProps),\r\n        ...args\r\n      );\r\n    }\r\n  }\r\n\r\n  return originalConnect(mapStateToProps, ...args);\r\n}\r\n\r\nexport function create(initialState = {}, ...middlewares) {\r\n  let currentReducer;\r\n\r\n  const lazyDispatch = (state, ...actions) => {\r\n    return { type: types.dispatch, state, actions };\r\n  };\r\n  const defaultReducer = (state = initialState, action) => {\r\n    // is custom action\r\n    if (action.type in actions) {\r\n      const actionHandler = actions[action.type].handler;\r\n      const actionResult = actionHandler(state, action.payload, lazyDispatch);\r\n\r\n      if (actionResult && actionResult.type === types.dispatch) {\r\n        setTimeout(() => {\r\n          actionResult.actions.forEach(action => store.dispatch(action));\r\n        }, 0);\r\n        return actionResult.state;\r\n      }\r\n      return actionResult;\r\n    }\r\n    return currentReducer ? currentReducer(state, action) : state;\r\n  };\r\n\r\n  const store = createStore(\r\n    defaultReducer,\r\n    applyMiddleware(...[defaultMiddleware].concat(middlewares))\r\n  );\r\n\r\n  return Object.assign({}, store, {\r\n    // register reducer\r\n    reducer(reducer) {\r\n      if (typeof reducer !== \"function\") {\r\n        reducer = combineReducers(reducer);\r\n      }\r\n      if (currentReducer) {\r\n        const prevReducer = currentReducer;\r\n        currentReducer = (state, action) =>\r\n          reducer(prevReducer(state, action), action);\r\n      } else {\r\n        currentReducer = reducer;\r\n      }\r\n\r\n      // dispatch init method after reducer added\r\n      store.dispatch({ type: types.init });\r\n    },\r\n    Provider(props) {\r\n      return React.createElement(Provider, Object.assign({ store }, props));\r\n    }\r\n  });\r\n}\r\n\r\nexport default create;\r\n"]}